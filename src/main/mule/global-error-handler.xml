<?xml version="1.0" encoding="UTF-8"?>

<mule xmlns:ee="http://www.mulesoft.org/schema/mule/ee/core" xmlns="http://www.mulesoft.org/schema/mule/core"
	xmlns:doc="http://www.mulesoft.org/schema/mule/documentation"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
http://www.mulesoft.org/schema/mule/ee/core http://www.mulesoft.org/schema/mule/ee/core/current/mule-ee.xsd">
	<error-handler name="global-error-handler-error-handler" doc:id="2386ba91-92b7-47dc-b7c0-64f7fee7f389" >
		<on-error-propagate enableNotifications="true" logException="true" doc:name="On Error Propagate" doc:id="6ec63e9f-055e-4c0a-b967-84ff1653cf7b" type="APIKIT:BAD_REQUEST" >
			<ee:transform doc:name="Transform Message" doc:id="d0988344-2437-46f3-acaa-54cb9b0b16c4" >
				<ee:message >
					<ee:set-payload ><![CDATA[%dw 2.0
output application/json
var msg = error.description
var matches = msg scan /\[([^\]]+)\]/
var missingFields = matches map ((m) -> m[1])
---
if (sizeOf(missingFields) > 0) 
  {
    error: "Validation failed",
    missingFields: missingFields
  } 
else 
  {
    error: "Validation failed",
    description: error.detailedDescription
  }]]></ee:set-payload>
				</ee:message>
				<ee:variables >
					<ee:set-variable variableName="httpStatus" ><![CDATA[400]]></ee:set-variable>
				</ee:variables>
			</ee:transform>
		</on-error-propagate>
		<on-error-propagate enableNotifications="true" logException="true" doc:name="On Error Propagate1" doc:id="90d9dded-1b37-44e0-8a1b-661a05854105" type="APIKIT:NOT_FOUND" >
			<ee:transform doc:name="Transform Message" doc:id="c4c54d6c-b50b-4944-a2d1-606f61eb8457" >
				<ee:message >
					<ee:set-payload ><![CDATA[%dw 2.0
output application/json
---
{message: "Resource not found"}]]></ee:set-payload>
				</ee:message>
				<ee:variables >
					<ee:set-variable variableName="httpStatus" ><![CDATA[404]]></ee:set-variable>
				</ee:variables>
			</ee:transform>
		</on-error-propagate>
		<on-error-propagate enableNotifications="true" logException="true" doc:name="On Error Propagate2" doc:id="49096d7e-83fb-448d-a20f-7e88f12b94e4" type="APIKIT:METHOD_NOT_ALLOWED" >
			<ee:transform doc:name="Transform Message" doc:id="5fe79fc4-5a2a-4f44-9bdb-db51663ef803" >
				<ee:message >
					<ee:set-payload ><![CDATA[%dw 2.0
output application/json
---
{message: "Method not allowed"}]]></ee:set-payload>
				</ee:message>
				<ee:variables >
					<ee:set-variable variableName="httpStatus" ><![CDATA[405]]></ee:set-variable>
				</ee:variables>
			</ee:transform>
		</on-error-propagate>
		<on-error-propagate enableNotifications="true" logException="true" doc:name="On Error Propagate3" doc:id="e2cfbe14-382e-4330-a3f6-a4def57bde98" type="APIKIT:NOT_ACCEPTABLE" >
			<ee:transform doc:name="Transform Message" doc:id="a5a9b0d2-723e-4745-8bba-d57d67ad8ef3" >
				<ee:message >
					<ee:set-payload ><![CDATA[%dw 2.0
output application/json
---
{message: "Not acceptable"}]]></ee:set-payload>
				</ee:message>
				<ee:variables >
					<ee:set-variable variableName="httpStatus" ><![CDATA[406]]></ee:set-variable>
				</ee:variables>
			</ee:transform>
		</on-error-propagate>
		<on-error-propagate enableNotifications="true" logException="true" doc:name="On Error Propagate4" doc:id="5059169f-5eaf-4963-8455-03b74cc9b899" type="APIKIT:UNSUPPORTED_MEDIA_TYPE" >
			<ee:transform doc:name="Transform Message" doc:id="84a0c9a1-98a4-4f26-a7b1-5610b62b9566" >
				<ee:message >
					<ee:set-payload ><![CDATA[%dw 2.0
output application/json
---
{message: "Unsupported media type"}]]></ee:set-payload>
				</ee:message>
				<ee:variables >
					<ee:set-variable variableName="httpStatus" ><![CDATA[415]]></ee:set-variable>
				</ee:variables>
			</ee:transform>
		</on-error-propagate>
		<on-error-propagate enableNotifications="true" logException="true" doc:name="On Error Propagate5" doc:id="49f243bb-cf8e-451f-b784-018ea7c42dc6" type="APIKIT:NOT_IMPLEMENTED" >
			<ee:transform doc:name="Transform Message" doc:id="a9bf2465-c9b1-461e-9d21-2ef262cae22f" >
				<ee:message >
					<ee:set-payload ><![CDATA[%dw 2.0
output application/json
---
{message: "Not Implemented"}]]></ee:set-payload>
				</ee:message>
				<ee:variables >
					<ee:set-variable variableName="httpStatus" ><![CDATA[501]]></ee:set-variable>
				</ee:variables>
			</ee:transform>
		</on-error-propagate>
	</error-handler>
</mule>
